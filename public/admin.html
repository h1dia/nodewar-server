<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹ ç‚¹æˆ¦ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; max-width: 800px; margin: 0 auto; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #333; }
        .input-group { margin-bottom: 20px; padding: 15px; background: #fafafa; border: 1px solid #ddd; border-radius: 5px; }
        .row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        input[type="text"] { flex: 2; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        input[type="number"] { padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .minute-input { flex: 1; min-width: 80px; }
        
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        .add-btn { background: #4CAF50; color: white; margin-bottom: 20px; }
        .save-btn { background: #c6a06d; color: white; width: 100%; font-size: 1.2rem; padding: 15px; }
        .del-btn { background: #ff5252; color: white; }
        #msg { margin-top: 15px; text-align: center; font-weight: bold; min-height: 1.5em; }
        .success { color: green; } .error { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ æ‹ ç‚¹æˆ¦ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†</h1>
        <div class="input-group">
            <label style="font-weight:bold;">é…å»¶ç§’æ•° (ç§’):</label>
            <input type="number" id="delay" value="0">
        </div>

        <h3>ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚¹ãƒˆ (21:00åŸºæº–)</h3>
        <p style="font-size:0.8rem; color:#666; margin-top:-10px;">ã€Œ20ã€ã¨å…¥åŠ› â†’ 21:00 + 20åˆ† + 1åˆ† = 21:21çµ‚äº†</p>
        <div id="timer-list"></div>
        
        <button class="add-btn" onclick="addRow()">ï¼‹ è¡Œã‚’è¿½åŠ </button>
        <hr style="border:0; border-top:1px solid #ddd; margin: 20px 0;">
        <button class="save-btn" onclick="saveData()">è¨­å®šã‚’ä¿å­˜ã—ã¦å…¬é–‹</button>
        <div id="msg"></div>
        <div style="margin-top:20px; text-align:right;"><a href="/" target="_blank">å…¬é–‹ãƒšãƒ¼ã‚¸ã‚’ç¢ºèª &rarr;</a></div>
    </div>

    <script>
        fetch('/api/data').then(res => res.json()).then(data => {
            document.getElementById('delay').value = data.delaySeconds;
            if(data.timers && data.timers.length > 0){
                data.timers.forEach(t => addRow(t.label, t.minutes));
            } else { addRow(); }
        });

        function addRow(label = "", minutes = "") {
            const div = document.createElement('div');
            div.className = 'row';
            div.innerHTML = `
                <input type="text" placeholder="ç ¦å" value="${label}">
                <input type="number" class="minute-input" placeholder="åˆ†" value="${minutes}">
                <button class="del-btn" onclick="this.parentElement.remove()">å‰Šé™¤</button>
            `;
            document.getElementById('timer-list').appendChild(div);
        }

        function saveData() {
            const btn = document.querySelector('.save-btn');
            btn.disabled = true; btn.textContent = "ä¿å­˜ä¸­...";
            const delaySeconds = parseInt(document.getElementById('delay').value) || 0;
            const timers = [];
            document.querySelectorAll('#timer-list .row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                if (inputs[0].value && inputs[1].value !== "") {
                    timers.push({ label: inputs[0].value, minutes: parseInt(inputs[1].value, 10) });
                }
            });
            fetch('/api/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ delaySeconds, timers })
            }).then(res => res.json()).then(data => {
                const msg = document.getElementById('msg');
                msg.innerHTML = data.success ? '<span class="success">âœ… ä¿å­˜ã—ã¾ã—ãŸï¼</span>' : '<span class="error">âŒ ã‚¨ãƒ©ãƒ¼</span>';
                setTimeout(() => msg.textContent = "", 3000);
            }).finally(() => { btn.disabled = false; btn.textContent = "è¨­å®šã‚’ä¿å­˜ã—ã¦å…¬é–‹"; });
        }
    </script>
</body>
</html>